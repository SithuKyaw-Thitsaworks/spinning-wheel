<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin Wheel Game</title>
    <style>
        .wheel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }

        .wheel {
            position: relative;
            width: 400px;
            height: 400px;
        }

        .wheel-svg {
            width: 100%;
            height: 100%;
            transform-origin: center;
            transition: transform 5s cubic-bezier(0.32, 0.94, 0.60, 1);
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: 2px solid #ddd;
            z-index: 2;
        }

        .wheel-pointer {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 40px;
            z-index: 2;
        }

        .wheel-pointer::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: #ff4444;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .spin-button {
            padding: 12px 24px;
            font-size: 18px;
            background: #4444ff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .spin-button:hover {
            background: #3333dd;
        }

        .spin-button:disabled {
            background: #999;
            cursor: not-allowed;
        }

        .segment-text {
            font-family: Arial, sans-serif;
            font-size: 3.5px;
            fill: white;
            user-select: none;
        }
    </style>
</head>

<body>
    <div class="wheel-container">
        <div class="wheel">
            <svg class="wheel-svg" viewBox="0 0 100 100">
                <!-- Segments will be added here by JavaScript -->
            </svg>
            <div class="wheel-center"></div>
            <div class="wheel-pointer"></div>
        </div>
        <button class="spin-button">SPIN</button>
    </div>

    <script>
        class SpinWheel {
            constructor(options = {}) {
                this.segments = options.segments || [
                    { label: 'Prize 1', color: '#FF6B6B' },
                    { label: 'Prize 2', color: '#4ECDC4' },
                    { label: 'Prize 3', color: '#45B7D1' },
                    { label: 'Prize 4', color: '#96CEB4' },
                    { label: 'Prize 5', color: '#FFEEAD' },
                    { label: 'Prize 6', color: '#D4A5A5' },
                    { label: 'Prize 7', color: '#9ED2C6' },
                    { label: 'Prize 8', color: '#FFB6B8' }
                ];
                this.spinDuration = options.spinDuration || 5000;
                this.onSpinEnd = options.onSpinEnd || ((segment) => console.log('Won:', segment));
                this.currentRotation = 0;
                this.isSpinning = false;

                this.wheelSvg = document.querySelector('.wheel-svg');
                this.spinButton = document.querySelector('.spin-button');

                this.init();
            }

            init() {
                this.drawWheel();
                this.spinButton.addEventListener('click', () => this.spin(2));
            }

            drawWheel() {
                const svgNS = "http://www.w3.org/2000/svg";
                const segmentAngle = 360 / this.segments.length;

                this.segments.forEach((segment, i) => {
                    const startAngle = i * segmentAngle;
                    const endAngle = (i + 1) * segmentAngle;

                    // Create segment path
                    const path = document.createElementNS(svgNS, "path");
                    const rad = segmentAngle * Math.PI / 180;
                    const pathData = `M50 50 L50 0 A50 50 0 0 1 ${50 + 50 * Math.sin(rad)} ${50 - 50 * Math.cos(rad)} Z`;

                    path.setAttribute("d", pathData);
                    path.setAttribute("fill", segment.color);
                    path.setAttribute("transform", `rotate(${startAngle} 50 50)`);

                    // Create segment text
                    const text = document.createElementNS(svgNS, "text");
                    text.textContent = segment.label;
                    text.setAttribute("x", "50");
                    text.setAttribute("y", "20");
                    text.setAttribute("class", "segment-text");
                    text.setAttribute("text-anchor", "middle");
                    text.setAttribute("transform", `
                        rotate(${startAngle + segmentAngle / 2} 50 50)
                    `);

                    this.wheelSvg.appendChild(path);
                    this.wheelSvg.appendChild(text);
                });
            }

            spin(forcedSegmentIndex = null) {
                if (this.isSpinning) return;

                this.isSpinning = true;
                this.spinButton.disabled = true;

                const segmentSize = 360 / this.segments.length;
                let targetRotation;

                if (forcedSegmentIndex !== null) {
                    const targetSegmentCenter = 360 - (forcedSegmentIndex * segmentSize + segmentSize / 2);
                    targetRotation = targetSegmentCenter + 1440; // 4 full rotations
                } else {
                    targetRotation = 1440 + Math.random() * 1440; // Random between 4-8 rotations
                }

                this.wheelSvg.style.transition = `transform ${this.spinDuration}ms cubic-bezier(0.32, 0.94, 0.60, 1)`;
                this.wheelSvg.style.transform = `rotate(${targetRotation}deg)`;

                setTimeout(() => {
                    // Calculate winning segment
                    const remainder = targetRotation % 360;
                    const finalSegmentIndex = Math.floor(((360 - remainder) / segmentSize) % this.segments.length);

                    // Reset rotation to the remainder and remove transition
                    this.wheelSvg.style.transition = 'none';
                    this.wheelSvg.style.transform = `rotate(${remainder}deg)`;

                    // Force a reflow to apply the transform immediately
                    void this.wheelSvg.offsetWidth;

                    // Restore transition for the next spin
                    this.wheelSvg.style.transition = `transform ${this.spinDuration}ms cubic-bezier(0.32, 0.94, 0.60, 1)`;

                    // Re-enable the spin button and reset the spinning flag
                    this.isSpinning = false;
                    this.spinButton.disabled = false;

                    // Trigger the spin end callback
                    this.onSpinEnd(this.segments[finalSegmentIndex]);
                }, this.spinDuration);
            }

        }

        // Initialize the wheel
        const wheel = new SpinWheel({
            onSpinEnd: (segment) => {
                alert(`Congratulations! You won: ${segment.label}`);
            }
        });

        // Example of forcing a specific outcome:
        // wheel.spin(2); // Will land on the third segment
    </script>
</body>

</html>
